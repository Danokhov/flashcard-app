<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ò—Å—Ç–æ—Ä–∏—è –Ω–µ–¥–µ–ª–∏ 1 ‚Äî Arzttermin</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    .modal { transition: opacity 0.3s ease; }
    .modal-content { transition: transform 0.3s ease; transform: scale(0.95); }
    .modal.is-open { opacity: 1; }
    .modal.is-open .modal-content { transform: scale(1); }

    .quiz-option { transition: all 0.15s ease; outline: none; }
    .quiz-option:hover { transform: translateY(-2px); box-shadow: 0 6px 10px -2px rgba(0,0,0,0.1); }
    .quiz-selected {
      background-color:#A5B4FC!important;
      color:#1E3A8A!important;
      border-color:#6366F1!important;
      box-shadow:0 4px 6px -1px rgba(99,102,241,0.3)!important;
    }
    .next-button-disabled {
      background-color:#D1D5DB!important;
      color:#6B7280!important;
      cursor:not-allowed;
      box-shadow:none!important;
    }
    .next-button-active {
      background:linear-gradient(to right,#4F46E5,#6366F1)!important;
      color:#fff!important;
      box-shadow:0 4px 10px -2px rgba(79,70,229,0.5);
      transition:all 0.2s ease;
    }
    .next-button-active:hover { opacity:.9; transform:translateY(-1px); }
    #question-box { border-left:5px solid #6366F1; }

    .story-visual-container img {
      width:100%;
      height:auto;
      display:block;
    }


/* –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –ü–†–û–ò–ì–†–´–í–ê–¢–ï–õ–Ø */
#audio-bar.fixed-audio-bar {
    position: fixed;
    top: env(safe-area-inset-top, 0px); /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —à–∞–ø–∫—É TG */
    left: 0;
    right: 0;
    z-index: 999;
    background: rgba(243, 244, 246, 0.97);
    backdrop-filter: blur(6px);
    padding-top: 0.5rem;
    padding-bottom: 0.75rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
#audio-bar.fixed-audio-bar {
    width: 100% !important;
    left: 0 !important;
    right: 0 !important;
    padding: 0.5rem 1rem !important;
    box-sizing: border-box;
}

#audio-bar.fixed-audio-bar > div {
    max-width: none !important;
    width: 100% !important;
    margin: 0 auto;
}
/* –ß—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø—Ä—ã–≥–∞–ª ‚Äî –æ—Ç—Å—Ç—É–ø –ø–æ–¥ –ø–∞–Ω–µ–ª—å */
#audio-bar-placeholder.fixed-visible {
    height: 120px; /* –ø–æ–¥–±–µ—Ä–∏ –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É —Ç–≤–æ–µ–≥–æ –±–∞—Ä–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ 100-130px) */
}

    .audio-main-button {
      transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
    }
    .audio-main-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(37,99,235,0.55);
      opacity:.95;
    }

    input[type="range"] { width:100%; cursor:pointer; }

    .accordion-content {
      max-height:0;
      overflow:hidden;
      transition:max-height 0.4s ease-in-out,opacity 0.4s ease-in-out;
      opacity:0;
      visibility:hidden;
    }
    .accordion-content.is-open {
      max-height:90vh;
      opacity:1;
      visibility:visible;
      overflow-y:auto;
    }


  </style>
</head>

<body class="min-h-screen bg-gray-100 font-sans"> <!-- –≤–æ—Ç —ç—Ç–æ—Ç pt-20 –≤–∞–∂–µ–Ω! -->
<div id="app" class="max-w-md mx-auto p-4 space-y-6">

  <!-- –∫–∞—Ä—Ç–∏–Ω–∫–∞ + –∞—É–¥–∏–æ -->
  <div class="story-visual-container rounded-xl shadow-xl overflow-hidden">
    <img src="Woche1_text.png"
         alt="–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –∫ –∏—Å—Ç–æ—Ä–∏–∏"
         onclick="event.preventDefault();event.stopPropagation();">
    <audio id="story-audio-player" src="Woche1_text.mp3"></audio>
  </div>

  <!-- –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <h1 class="text-2xl font-bold text-center text-gray-900">
    Der Termin beim Arzt
  </h1>

  <!-- –û–ë–Å–†–¢–ö–ê –ü–ê–ù–ï–õ–ò: —Å–Ω–∞—á–∞–ª–∞ –æ–±—ã—á–Ω–∞—è, –ø–æ—Ç–æ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è fixed -->
  <div id="audio-bar-wrapper">
    <div id="audio-bar">
      <div class="max-w-md mx-auto">
        <div class="bg-white rounded-2xl px-4 py-3 shadow-lg border border-gray-200 flex flex-col gap-2">
          <div class="flex items-center justify-center">
            <button id="audio-main-button"
                    class="audio-main-button rounded-full bg-blue-600 text-white px-7 py-2.5 flex items-center gap-2">
              <svg id="play-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664l-3.197-2.132z"
                      clip-rule="evenodd"></path>
              </svg>
              <svg id="pause-icon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                      d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a1 1 0 011 1v8a1 1 0 01-2 0V6a1 1 0 011-1zm3 1a1 1 0 00-1 1v8a1 1 0 102 0V6a1 1 0 00-1-1z"
                      clip-rule="evenodd"></path>
              </svg>
              <span id="audio-status" class="font-semibold text-base">Play</span>
            </button>
          </div>

          <div class="flex flex-col gap-1">
            <input id="audio-progress" type="range" min="0" max="100" value="0">
            <div class="flex justify-between text-xs text-gray-500">
              <span id="audio-current-time">0:00</span>
              <span id="audio-duration">0:00</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä, —á—Ç–æ–±—ã —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ ‚Äú–ø—Ä—ã–≥–∞–ª–∞‚Äù, –∫–æ–≥–¥–∞ –±–∞—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è fixed -->
  <div id="audio-bar-placeholder" style="height: 0;"></div>

  <!-- –ê–ö–ö–û–†–î–ï–û–ù–´ -->
  <div class="space-y-4">

    <!-- —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
      <button id="transcript-button"
              onclick="window.StoryApp.toggleAccordion('transcript-content')"
              class="w-full py-4 px-5 text-left text-lg font-semibold text-gray-700 hover:bg-gray-50 flex justify-between items-center transition">
        <span><span class="mr-3 text-green-500">üìñ</span>–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</span>
        <span id="transcript-arrow">&darr;</span>
      </button>
      <div id="transcript-content"
           class="accordion-content bg-gray-50 border-t border-gray-200 hidden p-4">
        <p class="mb-4 font-bold text-gray-800">Der Termin beim Arzt</p>
        <p class="mb-3">Als Thomas an einem Montagmorgen aufwacht, merkt er sofort, dass etwas nicht stimmt.</p>
        <p class="mb-3">Er ist v√∂llig verschwitzt, sein Kopf tut weh, der R√ºcken ist steif, und er hat Schmerzen im Magen.</p>
        <p class="mb-3">Au√üerdem f√ºhlt er sich m√ºde und schwach.</p>
        <p class="mb-3">Seine Frau schaut ihn besorgt an:</p>
        <p class="mb-3">‚ÄûThomas, du siehst gar nicht gut aus. Ich mache mir Sorgen. Du solltest lieber zum Arzt gehen.‚Äú</p>
        <p class="mb-3">Thomas nickt, aber er hat Angst, dass es etwas Schlimmes sein k√∂nnte.</p>
        <p class="mb-3">‚ÄûVielleicht ist es nur Stress‚Äú, murmelt er.</p>
        <p class="mb-3">‚ÄûVielleicht‚Äú, antwortet sie ruhig, ‚Äûaber deine Gesundheit ist wichtiger.‚Äú</p>
        <p class="mb-3">Er ruft an der Rezeption der Praxis an.</p>
        <p class="mb-3">Die Mitarbeiterin h√∂rt ihm aufmerksam zu, als er seine Beschwerden beschreibt.</p>
        <p class="mb-3">‚ÄûKommen Sie heute Nachmittag vorbei‚Äú, sagt sie. ‚ÄûWenn Sie Schmerzen haben, bekommen Sie nat√ºrlich schnell einen Termin.‚Äú</p>
        <p class="mb-3">Am Nachmittag sitzt Thomas im Wartezimmer.</p>
        <p class="mb-3">Es ist stickig, und er beginnt wieder zu schwitzen.</p>
        <p class="mb-3">Viele Menschen warten. Eine √§ltere Frau hustet, ein Kind h√§lt sich das Auge, und jemand st√∂hnt le–ª–µise vor Schmerzen.</p>
        <p class="mb-3">Thomas versucht ruhig zu atmen, doch der Magen brennt st√§rker, und ihm wird schwindlig.</p>
        <p class="mb-3">Endlich ruft die Arzthelferin: ‚ÄûHerr Berger, bitte!‚Äú</p>
        <p class="mb-3">Dr. Keller, ein freundlicher Hausarzt, begr√º√üt ihn:</p>
        <p class="mb-3">‚ÄûWas fehlt Ihnen?‚Äú</p>
        <p class="mb-3">Thomas erz√§hlt, dass er seit zwei Tagen kaum essen kann, sich schwach f√ºhlt und nachts leidet.</p>
        <p class="mb-3">Der Arzt misst den Blutdruck, h√∂rt den K√∂rper ab und erkl√§rt:</p>
        <p class="mb-3">‚ÄûSie haben wahrscheinlich eine Magenentz√ºndung. Ich verschreibe Ihnen starke Antibiotika. Sie m√ºssen sie regelm√§√üig einnehmen ‚Äì drei Mal am Tag nach dem Essen. Hier ist au√üerdem ein Rezept, damit Sie die Medikamente in der Apotheke bekommen.‚Äú</p>
        <p class="mb-3">Dann f√ºgt er hinzu:</p>
        <p class="mb-3">‚ÄûSie sollen die Antibiotika immer nach dem Essen einnehmen, damit der Magen sie besser vertr√§gt. Und Sie sollen mindestens drei Tage zu Hause bleiben und sich ausruhen.‚Äú</p>
        <p class="mb-3">Thomas fragt:</p>
        <p class="mb-3">‚ÄûWie lange soll ich die Tabletten nehmen?‚Äú</p>
        <p class="mb-3">Dr. Keller antwortet:</p>
        <p class="mb-3">‚ÄûF√ºnf Tage, dann sollte es Ihnen deutlich besser gehen.‚Äú</p>
        <p class="mb-3">‚ÄûDie Antibiotika wirken schnell, aber Sie brauchen Ruhe. Vermeiden Sie Kaffee und Alkohol.‚Äú</p>
        <p class="mb-3">Dann fragt er:</p>
        <p class="mb-3">‚ÄûBrauchen Sie auch ein Attest f√ºr die Arbeit?‚Äú</p>
        <p class="mb-3">Thomas antwortet:</p>
        <p class="mb-3">‚ÄûJa, bitte ‚Äì f√ºr drei Tage.‚Äú</p>
        <p class="mb-3">Dr. Keller notiert es und l√§chelt:</p>
        <p class="mb-3">‚ÄûIn Ordnung. Dann ruhen Sie sich gut aus.‚Äú</p>
        <p class="mb-3">Zu Hause hilft ihm seine Frau, das Fenster zu √∂ffnen, bringt Tee und Suppe ans Bett:</p>
        <p class="mb-3">‚ÄûIch werde dich gut pflegen, bis es dir besser geht.‚Äú</p>
        <p class="mb-3">Nach zwei Tagen geht es ihm schon besser.</p>
        <p class="mb-3">Die Schmerzen sind fast weg, das Brennen im Magen ist vorbei, und er kann wieder schlafen.</p>
        <p class="mb-3">Am dritten Tag f√ºhlt sich Thomas stark und –∏–∑geruht.</p>
        <p class="mb-3">Er beschlie√üt, am n√§chsten Morgen wieder zur Arbeit zu gehen ‚Äì froh, dass alles harmlos war und die Medikamente gut wirken.</p>
      </div>
    </div>

    <!-- —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—Å—Ç–∞ -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
      <button id="analysis-button"
              onclick="window.StoryApp.toggleAccordion('analysis-content')"
              class="w-full py-4 px-5 text-left text-lg font-semibold text-gray-700 hover:bg-gray-50 flex justify-between items-center transition">
        <span><span class="mr-3 text-blue-500">üìù</span>–†–∞–∑–±–æ—Ä —Ç–µ–∫—Å—Ç–∞</span>
        <span id="analysis-arrow">&darr;</span>
      </button>
      <div id="analysis-content"
           class="accordion-content bg-gray-50 border-t border-gray-200 hidden p-4">
        <div id="analysis-carousel" class="space-y-4">
          <div id="analysis-slide" class="space-y-3"></div>

          <div class="flex items-center justify-between mt-4">
            <button onclick="window.StoryApp.prevAnalysisSlide()"
                    class="py-2 px-4 bg-gray-200 text-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-300 transition">
              ‚Üê –ù–∞–∑–∞–¥
            </button>

            <span id="analysis-progress"
                  class="text-xs text-gray-500 mx-2 flex-1 text-center">
              1 / 1
            </span>

            <button onclick="window.StoryApp.nextAnalysisSlide()"
                    class="py-2 px-4 bg-indigo-500 text-white rounded-lg text-sm font-semibold hover:bg-indigo-600 transition">
              –í–ø–µ—Ä—ë–¥ ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –∫–Ω–æ–ø–∫–∞ –∫–≤–∏–∑–∞ -->
  <button onclick="window.StoryApp.startStoryQuiz()"
          class="w-full py-4 px-5 bg-indigo-500 text-white rounded-xl shadow-xl text-left text-lg font-bold 
                 hover:bg-indigo-600 transition flex justify-between items-center 
                 bg-gradient-to-r from-indigo-600 to-indigo-500 transform hover:scale-[1.01] hover:shadow-2xl mt-4">
    <span><span class="mr-3 text-yellow-300">üß†</span>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (–ö–≤–∏–∑)</span>
    <span>&rarr;</span>
  </button>
</div>

<!-- –º–æ–¥–∞–ª–∫–∞ –∫–≤–∏–∑–∞ -->
<div id="quiz-modal"
     class="modal hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 opacity-0"
     onclick="window.StoryApp.closeModal('quiz-modal')" role="dialog" aria-modal="true">
  <div id="quiz-modal-content"
       class="modal-content bg-white p-6 rounded-xl shadow-xl max-w-sm w-full"
       onclick="event.stopPropagation()">
    <h3 id="quiz-modal-title"
        class="text-xl font-bold mb-4 text-gray-800 text-center border-b pb-2">–ö–≤–∏–∑ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏</h3>

    <div class="text-sm text-gray-500 mb-4 text-center">
      <span id="quiz-progress">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 3</span>
    </div>

    <div id="quiz-scroll-area" class="max-h-[65vh] overflow-y-auto pr-2">
      <div id="question-box" class="bg-indigo-50 p-4 rounded-lg mb-4 shadow-inner">
        <p id="quiz-question" class="text-xl font-bold text-gray-800"></p>
      </div>
      <div id="quiz-options" class="space-y-3"></div>
      <p id="quiz-feedback" class="mt-4 text-center text-xl font-extrabold hidden"></p>
    </div>

    <button id="quiz-next-button"
            onclick="window.StoryApp.nextQuizQuestion()"
            class="w-full mt-6 py-3 px-4 font-bold rounded-xl shadow-md transition next-button-disabled"
            disabled>
      –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
    </button>

    <div id="quiz-end-controls" class="space-y-3 mt-6 hidden">
      <button onclick="window.StoryApp.startStoryQuiz()"
              class="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-xl shadow-md hover:bg-blue-600 transition">
        –ü—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑
      </button>
      <button onclick="window.StoryApp.showCorrectAnswers()"
              class="w-full py-3 px-4 bg-yellow-500 text-yellow-900 font-bold rounded-xl shadow-md hover:bg-yellow-600 transition">
        –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
      </button>
      <button onclick="window.StoryApp.closeModal('quiz-modal')"
              class="w-full py-3 px-4 bg-gray-500 text-white font-bold rounded-xl shadow-md hover:bg-gray-600 transition">
        –ó–∞–≤–µ—Ä—à–∏—Ç—å
      </button>
    </div>
  </div>
</div>

<script>
const QUIZ_DATA = [
  {
    question: "–ß—Ç–æ —á—É–≤—Å—Ç–≤—É–µ—Ç –¢–æ–º–∞—Å —É—Ç—Ä–æ–º?",
    answer: "–ï–º—É –ø–ª–æ—Ö–æ: –∂–∞—Ä, –±–æ–ª—å, —Å–ª–∞–±–æ—Å—Ç—å",
    options: [
      "–û–Ω –ø–æ–ª–æ–Ω —ç–Ω–µ—Ä–≥–∏–∏",
      "–ï–º—É –ø–ª–æ—Ö–æ: –∂–∞—Ä, –±–æ–ª—å, —Å–ª–∞–±–æ—Å—Ç—å",
      "–û–Ω –ø—Ä–æ—Å—Ç–æ –Ω–µ–º–Ω–æ–≥–æ –≥–æ–ª–æ–¥–µ–Ω"
    ]
  },
  {
    question: "–ß—Ç–æ —Å–æ–≤–µ—Ç—É–µ—Ç –∂–µ–Ω–∞ –¢–æ–º–∞—Å—É?",
    answer: "–ü–æ–π—Ç–∏ –∫ –≤—Ä–∞—á—É",
    options: [
      "–ü–æ–π—Ç–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É",
      "–í—ã–ø–∏—Ç—å –∫–æ—Ñ–µ –∏ –ø–æ–¥–æ–∂–¥–∞—Ç—å",
      "–ü–æ–π—Ç–∏ –∫ –≤—Ä–∞—á—É"
    ]
  },
  {
    question: "–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –≤—Ä–∞—á –Ω–∞—Å—á—ë—Ç –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–æ–≤?",
    answer: "–ü—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ—Å–ª–µ –µ–¥—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π",
    options: [
      "–ü–∏—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–Ω–æ–≤–∞ —Å—Ç–∞–Ω–µ—Ç –±–æ–ª—å–Ω–æ",
      "–ü—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ—Å–ª–µ –µ–¥—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π",
      "–ú–æ–∂–Ω–æ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å —Å—Ä–∞–∑—É, –∫–∞–∫ —Å—Ç–∞–Ω–µ—Ç –ª—É—á—à–µ"
    ]
  }
];

const ANALYSIS_SLIDES = [
  {
    title: "–ù–∞—á–∞–ª–æ –∏—Å—Ç–æ—Ä–∏–∏",
    original: "Als Thomas an einem Montagmorgen aufwacht, merkt er sofort, dass etwas nicht stimmt. Er ist v√∂llig verschwitzt, sein Kopf tut weh, der R√ºcken ist steif, und er hat Schmerzen im Magen.",
    translation: "–ö–æ–≥–¥–∞ –¢–æ–º–∞—Å –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ —É—Ç—Ä–æ–º, –æ–Ω —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫. –û–Ω –≤–µ—Å—å –≤ –ø–æ—Ç—É, —É –Ω–µ–≥–æ –±–æ–ª–∏—Ç –≥–æ–ª–æ–≤–∞, –∑–∞—Ç–µ–∫–ª–∞ —Å–ø–∏–Ω–∞ –∏ –±–æ–ª–∏—Ç –∂–µ–ª—É–¥–æ–∫.",
    notes: [
      "etwas stimmt nicht ‚Äì —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫",
      "Mir tut der Kopf weh ‚Äì —É –º–µ–Ω—è –±–æ–ª–∏—Ç –≥–æ–ª–æ–≤–∞",
      "Schmerzen im Magen haben ‚Äì –±–æ–ª–∏—Ç –∂–µ–ª—É–¥–æ–∫"
    ]
  },
  {
    title: "–ñ–µ–Ω–∞ —Å–æ–≤–µ—Ç—É–µ—Ç –≤—Ä–∞—á–∞",
    original: "Au√üerdem f√ºhlt er sich m√ºde und schwach. Seine Frau schaut ihn besorgt an: ‚ÄûThomas, du siehst gar nicht gut aus. Ich mache mir Sorgen. Du solltest lieber zum Arzt gehen.‚Äú",
    translation: "–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –æ–Ω —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–µ–±—è —É—Å—Ç–∞–ª—ã–º –∏ —Å–ª–∞–±—ã–º. –ñ–µ–Ω–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –Ω–µ–≥–æ —Å —Ç—Ä–µ–≤–æ–≥–æ–π: ¬´–¢–æ–º–∞—Å, —Ç—ã –≤—ã–≥–ª—è–¥–∏—à—å —Å–æ–≤—Å–µ–º –ø–ª–æ—Ö–æ. –Ø –≤–æ–ª–Ω—É—é—Å—å. –¢–µ–±–µ –ª—É—á—à–µ –±—ã —Å—Ö–æ–¥–∏—Ç—å –∫ –≤—Ä–∞—á—É¬ª.",
    notes: [
      "sich m√ºde / schwach f√ºhlen ‚Äì —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è —É—Å—Ç–∞–ª—ã–º / —Å–ª–∞–±—ã–º",
      "sich Sorgen machen ‚Äì –≤–æ–ª–Ω–æ–≤–∞—Ç—å—Å—è",
      "du solltest lieber ... ‚Äì —Ç–µ–±–µ –ª—É—á—à–µ –±—ã ..."
    ]
  },
  {
    title: "–î–∏–∞–≥–Ω–æ–∑ –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞",
    original: "‚ÄûSie haben wahrscheinlich eine Magenentz√ºndung. Ich verschreibe Ihnen starke Antibiotika. Sie m√ºssen sie regelm√§√üig einnehmen ‚Äì drei Mal am Tag nach dem Essen.‚Äú",
    translation: "¬´–£ –≤–∞—Å, –≤–µ—Ä–æ—è—Ç–Ω–æ, –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –∂–µ–ª—É–¥–∫–∞. –Ø –≤—ã–ø–∏—à—É –≤–∞–º —Å–∏–ª—å–Ω—ã–µ –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏. –í—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏—Ö —Ä–µ–≥—É–ª—è—Ä–Ω–æ ‚Äî —Ç—Ä–∏ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å –ø–æ—Å–ª–µ –µ–¥—ã¬ª.",
    notes: [
      "eine Magenentz√ºndung ‚Äì –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –∂–µ–ª—É–¥–∫–∞",
      "Medikamente verschreiben ‚Äì –≤—ã–ø–∏—Å–∞—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞",
      "Tabletten einnehmen ‚Äì –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–∞–±–ª–µ—Ç–∫–∏"
    ]
  }
];

window.StoryApp = {
  quizData: QUIZ_DATA,
  currentIndex: 0,
  userAnswers: [],
  analysisSlides: ANALYSIS_SLIDES,
  currentAnalysisIndex: 0,

  init() {
    this.initAudioPlayback();
    this.initAnalysisCarousel();
    this.initStickyAudioBar();
  },

  /* ====== –ê–£–î–ò–û ====== */
  initAudioPlayback() {
    const audio = document.getElementById('story-audio-player');
    const playBtn = document.getElementById('audio-main-button');
    const progress = document.getElementById('audio-progress');
    const curTimeEl = document.getElementById('audio-current-time');
    const durEl = document.getElementById('audio-duration');

    if (!audio) return;

    if (playBtn) {
      playBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        this.toggleAudioPlay();
      });
    }

    audio.addEventListener('loadedmetadata', () => {
      if (durEl && isFinite(audio.duration)) {
        durEl.textContent = this.formatTime(audio.duration);
      }
    });

    audio.addEventListener('timeupdate', () => {
      if (progress && isFinite(audio.duration) && audio.duration > 0) {
        progress.value = (audio.currentTime / audio.duration) * 100;
      }
      if (curTimeEl) {
        curTimeEl.textContent = this.formatTime(audio.currentTime);
      }
    });

    if (progress) {
      progress.addEventListener('input', (e) => {
        if (!isFinite(audio.duration) || audio.duration <= 0) return;
        const val = Number(e.target.value) || 0;
        audio.currentTime = (val / 100) * audio.duration;
      });
    }

    audio.onplay = () => this.updateAudioUi(true);
    audio.onpause = () => this.updateAudioUi(false);
    audio.onended = () => this.updateAudioUi(false);
  },

  formatTime(sec) {
    const s = Math.floor(sec % 60);
    const m = Math.floor(sec / 60);
    return `${m}:${s.toString().padStart(2, '0')}`;
  },

  toggleAudioPlay() {
    const audio = document.getElementById('story-audio-player');
    if (!audio) return;
    if (audio.paused) audio.play(); else audio.pause();
  },

  updateAudioUi(isPlaying) {
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const status = document.getElementById('audio-status');
    if (!playIcon || !pauseIcon || !status) return;

    if (isPlaying) {
      playIcon.classList.add('hidden');
      pauseIcon.classList.remove('hidden');
      status.textContent = 'Pause';
    } else {
      playIcon.classList.remove('hidden');
      pauseIcon.classList.add('hidden');
      status.textContent = 'Play';
    }
  },

  /* ====== FIXED AUDIO BAR ====== */
initStickyAudioBar() {
    const wrapper     = document.getElementById('audio-bar-wrapper');
    const bar         = document.getElementById('audio-bar');
    const placeholder = document.getElementById('audio-bar-placeholder');
    if (!wrapper || !bar || !placeholder) return;

    // –í—ã—á–∏—Å–ª—è–µ–º –≤—ã—Å–æ—Ç—É —à–∞–ø–∫–∏ Telegram
    const getTelegramHeaderHeight = () => {
        if (window.Telegram?.WebApp?.viewportStableHeight) {
            return window.innerHeight - window.Telegram.WebApp.viewportStableHeight;
        }
        return 56; // –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
    };

    let barHeight = 0;
    const headerHeight = getTelegramHeaderHeight();

    const checkPosition = () => {
        const wrapperRect = wrapper.getBoundingClientRect();

        // –ö–æ–≥–¥–∞ –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –æ–±—ë—Ä—Ç–∫–∏ –¥–æ—à–ª–∞ –¥–æ –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã —à–∞–ø–∫–∏ TG
        if (wrapperRect.top <= headerHeight) {
            if (!bar.classList.contains('fixed-audio-bar')) {
                barHeight = bar.offsetHeight;
                bar.classList.add('fixed-audio-bar');
                placeholder.style.height = barHeight + 'px';
                bar.style.top = headerHeight + 'px';
            }
        } else {
            if (bar.classList.contains('fixed-audio-bar')) {
                bar.classList.remove('fixed-audio-bar');
                placeholder.style.height = '0px';
                bar.style.top = '';
            }
        }
    };

    window.addEventListener('scroll', checkPosition);
    window.addEventListener('resize', checkPosition);
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —É–∂–µ –ø—Ä–æ—Å–∫—Ä–æ–ª–ª–µ–Ω–æ)
    setTimeout(checkPosition, 100);
},

  /* ====== –ê–ö–ö–û–†–î–ï–û–ù–´ ====== */
  toggleAccordion(contentId) {
    const content = document.getElementById(contentId);
    const arrow = document.getElementById(contentId.replace('-content', '-arrow'));
    if (!content || !arrow) return;

    const isOpen = content.classList.contains('is-open');
    if (isOpen) {
      content.classList.remove('is-open');
      arrow.innerHTML = '&darr;';
      setTimeout(() => content.classList.add('hidden'), 400);
    } else {
      content.classList.remove('hidden');
      setTimeout(() => content.classList.add('is-open'), 10);
      arrow.innerHTML = '&uarr;';
    }
  },

  /* ====== –ö–ê–†–£–°–ï–õ–¨ –†–ê–ó–ë–û–†–ê ====== */
  initAnalysisCarousel() {
    if (!this.analysisSlides.length) return;
    this.currentAnalysisIndex = 0;
    this.renderAnalysisSlide();
  },

  renderAnalysisSlide() {
    const slideContainer = document.getElementById('analysis-slide');
    const progressEl = document.getElementById('analysis-progress');
    if (!slideContainer) return;

    const slide = this.analysisSlides[this.currentAnalysisIndex];
    if (!slide) return;

    slideContainer.innerHTML = `
      <p class="mb-1 text-xs font-semibold uppercase tracking-wide text-indigo-600">
        ${slide.title || '–†–∞–∑–±–æ—Ä'}
      </p>
      <p class="mb-2 font-semibold text-gray-800">${slide.original}</p>
      <p class="mb-3 text-gray-700">${slide.translation}</p>
      ${
        slide.notes && slide.notes.length
          ? `<ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
               ${slide.notes.map(n => `<li>${n}</li>`).join('')}
             </ul>`
          : ''
      }
    `;

    if (progressEl) {
      const total = this.analysisSlides.length;
      const current = this.currentAnalysisIndex + 1;
      progressEl.textContent = `${current} / ${total}`;
    }
  },

  nextAnalysisSlide() {
    if (!this.analysisSlides.length) return;
    this.currentAnalysisIndex =
      (this.currentAnalysisIndex + 1) % this.analysisSlides.length;
    this.renderAnalysisSlide();
  },

  prevAnalysisSlide() {
    if (!this.analysisSlides.length) return;
    this.currentAnalysisIndex =
      (this.currentAnalysisIndex - 1 + this.analysisSlides.length) % this.analysisSlides.length;
    this.renderAnalysisSlide();
  },

  /* ====== –ö–í–ò–ó ====== */
  startStoryQuiz() {
    this.currentIndex = 0;
    this.userAnswers = [];
    this.renderCurrentQuestion();
    this.updateProgress();
    this.resetControls();
    this.openModal('quiz-modal');
  },

  renderCurrentQuestion() {
    const q = this.quizData[this.currentIndex];
    if (!q) return;

    const questionEl = document.getElementById('quiz-question');
    const optionsContainer = document.getElementById('quiz-options');
    const feedbackEl = document.getElementById('quiz-feedback');

    if (!questionEl || !optionsContainer || !feedbackEl) return;

    questionEl.textContent = q.question;
    optionsContainer.innerHTML = '';

    q.options.forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.className =
        'quiz-option w-full py-2 px-3 border border-gray-300 rounded-lg text-sm text-left bg-white text-gray-800 font-medium hover:bg-indigo-100';
      btn.textContent = opt;
      btn.onclick = () => this.selectOption(idx);
      optionsContainer.appendChild(btn);
    });

    feedbackEl.classList.add('hidden');
    feedbackEl.textContent = '';

    const endControls = document.getElementById('quiz-end-controls');
    if (endControls) endControls.classList.add('hidden');

    const nextBtn = document.getElementById('quiz-next-button');
    if (nextBtn) {
      nextBtn.disabled = true;
      nextBtn.classList.add('next-button-disabled');
      nextBtn.classList.remove('next-button-active', 'hidden');
    }
  },

  selectOption(idx) {
    const q = this.quizData[this.currentIndex];
    if (!q) return;

    const chosen = q.options[idx];
    this.userAnswers[this.currentIndex] = chosen;

    document.querySelectorAll('#quiz-options .quiz-option').forEach(btn => {
      btn.classList.remove('quiz-selected');
      if (btn.textContent.trim() === chosen.trim()) {
        btn.classList.add('quiz-selected');
      }
    });

    const nextBtn = document.getElementById('quiz-next-button');
    if (nextBtn) {
      nextBtn.disabled = false;
      nextBtn.classList.remove('next-button-disabled');
      nextBtn.classList.add('next-button-active');
    }
  },

  nextQuizQuestion() {
    if (this.currentIndex < this.quizData.length - 1) {
      this.currentIndex++;
      this.renderCurrentQuestion();
      this.updateProgress();
    } else {
      this.finishQuiz();
    }
  },

  updateProgress() {
    const progressEl = document.getElementById('quiz-progress');
    if (!progressEl) return;

    const total = this.quizData.length;
    const current = this.currentIndex + 1;
    progressEl.textContent = `–í–æ–ø—Ä–æ—Å ${current} –∏–∑ ${total}`;
  },

  resetControls() {
    const endControls = document.getElementById('quiz-end-controls');
    if (endControls) endControls.classList.add('hidden');

    const nextBtn = document.getElementById('quiz-next-button');
    if (nextBtn) {
      nextBtn.disabled = true;
      nextBtn.classList.add('next-button-disabled');
      nextBtn.classList.remove('next-button-active', 'hidden');
    }

    const feedbackEl = document.getElementById('quiz-feedback');
    if (feedbackEl) {
      feedbackEl.classList.add('hidden');
      feedbackEl.textContent = '';
    }
  },

  finishQuiz() {
    const total = this.quizData.length;
    let correct = 0;

    this.quizData.forEach((q, i) => {
      if (this.userAnswers[i] === q.answer) correct++;
    });

    const feedbackEl = document.getElementById('quiz-feedback');
    if (feedbackEl) {
      feedbackEl.textContent = `–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ ${correct} –∏–∑ ${total} –≤–æ–ø—Ä–æ—Å–æ–≤.`;
      feedbackEl.classList.remove('hidden');
    }

    const nextBtn = document.getElementById('quiz-next-button');
    if (nextBtn) nextBtn.classList.add('hidden');

    const endControls = document.getElementById('quiz-end-controls');
    if (endControls) endControls.classList.remove('hidden');
  },

  showCorrectAnswers() {
    const optionsContainer = document.getElementById('quiz-options');
    const feedbackEl = document.getElementById('quiz-feedback');
    if (!optionsContainer) return;

    optionsContainer.innerHTML = '';

    this.quizData.forEach((q, i) => {
      const block = document.createElement('div');
      block.className = 'mb-3 p-3 bg-indigo-50 rounded-lg';
      block.innerHTML = `
        <p class="font-semibold mb-1">${i + 1}. ${q.question}</p>
        <p class="text-green-700 font-bold">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${q.answer}</p>
      `;
      optionsContainer.appendChild(block);
    });

    if (feedbackEl) feedbackEl.classList.add('hidden');
  },

  /* ====== –ú–û–î–ê–õ–ö–ò ====== */
  openModal(id) {
    const modal = document.getElementById(id);
    const content = modal ? modal.querySelector('.modal-content') : null;
    if (!modal) return;

    modal.classList.remove('hidden');
    setTimeout(() => {
      modal.classList.add('is-open', 'opacity-100');
      if (content) content.classList.add('is-open');
    }, 10);
  },

  closeModal(id) {
    const modal = document.getElementById(id);
    const content = modal ? modal.querySelector('.modal-content') : null;
    if (!modal) return;

    modal.classList.remove('is-open', 'opacity-100');
    if (content) content.classList.remove('is-open');
    setTimeout(() => modal.classList.add('hidden'), 300);
  }
};

window.addEventListener('load', () => {
  window.StoryApp.init();
});
</script>

</body>
</html>


